---
phase: 08-design-foundation
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/routes/track/[slug]/+page.svelte
  - src/lib/components/PersistentPlayer.svelte
  - src/lib/components/WaveformPlayer.svelte
  - src/routes/admin/+layout.svelte
  - src/routes/admin/+page.svelte
  - src/routes/admin/upload/+page.svelte
  - src/routes/admin/tracks/[id]/+page.svelte
autonomous: false

must_haves:
  truths:
    - "Track detail page uses semantic tokens with font-heading on titles and font-mono on timestamps"
    - "Waveform players read colors from CSS custom properties instead of hardcoded hex values"
    - "Persistent player bar uses semantic tokens with font-mono on time display"
    - "Admin pages use semantic tokens while preserving status color badges (emerald/amber/red)"
    - "Every text element passes WCAG AA contrast (4.5:1 minimum) -- no zinc-500 or zinc-600 on dark backgrounds"
    - "Zero hardcoded zinc/violet references remain anywhere in the codebase (except status badge colors in admin)"
  artifacts:
    - path: "src/routes/track/[slug]/+page.svelte"
      provides: "Track detail page with semantic tokens and typography hierarchy"
      min_lines: 80
    - path: "src/lib/components/PersistentPlayer.svelte"
      provides: "Player bar with semantic tokens and CSS variable waveform colors"
      contains: "getComputedStyle"
    - path: "src/lib/components/WaveformPlayer.svelte"
      provides: "Standalone waveform with semantic tokens and CSS variable colors"
      contains: "getComputedStyle"
  key_links:
    - from: "src/lib/components/WaveformPlayer.svelte"
      to: "src/app.css"
      via: "getComputedStyle reads --color-waveform-* CSS variables"
      pattern: "getPropertyValue.*--color-waveform"
    - from: "src/lib/components/PersistentPlayer.svelte"
      to: "src/app.css"
      via: "getComputedStyle reads --color-waveform-* CSS variables"
      pattern: "getPropertyValue.*--color-waveform"
---

<objective>
Migrate the remaining 7 files (track detail, waveform players, admin pages) from hardcoded colors to semantic design tokens, including replacing hex wavesurfer colors with CSS custom property reads. Complete the full codebase migration and verify WCAG AA compliance visually.

Purpose: Completes the design system migration started in Plan 01. After this, zero hardcoded zinc/violet references remain in the codebase, all waveform colors are token-driven, and the entire site passes WCAG AA contrast.
Output: Fully migrated codebase with visual verification.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-design-foundation/08-RESEARCH.md
@.planning/phases/08-design-foundation/08-01-SUMMARY.md
@src/app.css
@src/routes/track/[slug]/+page.svelte
@src/lib/components/PersistentPlayer.svelte
@src/lib/components/WaveformPlayer.svelte
@src/routes/admin/+layout.svelte
@src/routes/admin/+page.svelte
@src/routes/admin/upload/+page.svelte
@src/routes/admin/tracks/[id]/+page.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate track detail, waveform players, and admin files to semantic tokens</name>
  <files>src/routes/track/[slug]/+page.svelte, src/lib/components/PersistentPlayer.svelte, src/lib/components/WaveformPlayer.svelte, src/routes/admin/+layout.svelte, src/routes/admin/+page.svelte, src/routes/admin/upload/+page.svelte, src/routes/admin/tracks/[id]/+page.svelte</files>
  <action>
Apply the color and font mapping from RESEARCH.md to all 7 files. This is the heaviest migration task -- track/[slug] alone has 15+ replacements.

**src/routes/track/[slug]/+page.svelte** (heaviest file):
- Back link: `text-zinc-500` -> `text-text-muted`, `hover:text-zinc-300` -> `hover:text-text-secondary`
- h1 title: `text-white` -> `text-text-primary`, add `font-heading`
- Edit link: `text-zinc-600` -> `text-text-muted` (WCAG fix: was 2.57:1!), `hover:text-zinc-400` -> `hover:text-text-tertiary`
- Category badge: `bg-zinc-800` -> `bg-surface-overlay`, `text-zinc-400` -> `text-text-tertiary`
- Duration: `text-zinc-400` -> `text-text-tertiary`, add `font-mono tabular-nums`
- Play count: `text-zinc-500` -> `text-text-muted` (WCAG fix)
- Tag pills: `bg-zinc-800` -> `bg-surface-overlay`, `text-zinc-400` -> `text-text-tertiary`
- Play/Pause button: `bg-violet-600` -> `bg-accent`, `hover:bg-violet-500` -> `hover:bg-accent-hover`
- Now playing text: `text-violet-400` -> `text-accent-muted`
- Queue button: `text-zinc-500` -> `text-text-muted`, `hover:text-zinc-300` -> `hover:text-text-secondary`
- Section heading h2: `text-zinc-300` -> `text-text-secondary`, add `font-heading`
- Description: `text-zinc-400` -> `text-text-tertiary`
- Divider: `border-zinc-800/50` -> `border-border-subtle`
- Date: `text-zinc-600` -> `text-text-muted` (CRITICAL WCAG fix: was 2.57:1 ratio!)

**src/lib/components/WaveformPlayer.svelte:**
- Replace hardcoded hex colors with CSS custom property reads. In the `init` async function, BEFORE creating WaveSurfer, add:
  ```typescript
  const styles = getComputedStyle(document.documentElement);
  const waveColor = styles.getPropertyValue('--color-waveform-idle').trim();
  const progressColor = styles.getPropertyValue('--color-waveform-progress').trim();
  const cursorColor = styles.getPropertyValue('--color-waveform-cursor').trim();
  ```
  Then in WaveSurfer.create config, replace:
  - `waveColor: '#4a4a5a'` -> `waveColor: waveColor || '#4a4a5a'` (fallback if CSS var empty)
  - `progressColor: '#8b5cf6'` -> `progressColor: progressColor || '#8b5cf6'`
  - `cursorColor: '#8b5cf6'` -> `cursorColor: cursorColor || '#8b5cf6'`
- Loading text: `text-zinc-500` -> `text-text-muted`
- Play button: `bg-violet-600` -> `bg-accent`, `hover:bg-violet-500` -> `hover:bg-accent-hover`
- Time display: `text-zinc-400` -> `text-text-tertiary` (already has font-mono tabular-nums, keep those)
- Vol label: `text-zinc-500` -> `text-text-muted`
- Volume slider: `accent-violet-500` -> `accent-accent`

**src/lib/components/PersistentPlayer.svelte:**
- Replace hex waveform colors same pattern as WaveformPlayer. In the `init` async function, BEFORE ws = WaveSurfer.create(), add getComputedStyle reads for waveform-idle and waveform-progress, then use with fallbacks.
  - `waveColor: '#4a4a5a'` -> `waveColor: waveColor || '#4a4a5a'`
  - `progressColor: '#8b5cf6'` -> `progressColor: progressColor || '#8b5cf6'`
- Player bar: `bg-zinc-900/95` -> `bg-surface-raised/95`, `border-zinc-800` -> `border-border-subtle`
- Placeholder art: `bg-zinc-800` -> `bg-surface-overlay`, `text-zinc-600` -> `text-text-muted`
- Track title: `text-zinc-200` -> `text-text-secondary`
- Timestamp: `text-zinc-500` -> `text-text-muted` (WCAG fix), already has font-mono tabular-nums
- Prev/Next buttons: `text-zinc-400` -> `text-text-tertiary`, `hover:text-white` -> `hover:text-text-primary`, `bg-zinc-700` -> `bg-surface-hover`, `hover:bg-zinc-600` -> `hover:bg-surface-hover`
- Play button: `bg-violet-600` -> `bg-accent`, `hover:bg-violet-500` -> `hover:bg-accent-hover`
- Vol label: `text-zinc-500` -> `text-text-muted`
- Volume slider: `accent-violet-500` -> `accent-accent`

**src/routes/admin/+layout.svelte:**
- Admin title: `text-zinc-300` -> `text-text-secondary`, `hover:text-white` -> `hover:text-text-primary`, add `font-heading`
- Back link: `text-zinc-500` -> `text-text-muted`, `hover:text-zinc-300` -> `hover:text-text-secondary`

**src/routes/admin/+page.svelte:**
- h1: `text-white` -> `text-text-primary`, add `font-heading`
- Upload button: `bg-violet-600` -> `bg-accent`, `hover:bg-violet-500` -> `hover:bg-accent-hover`
- Track count: `text-zinc-500` -> `text-text-muted`
- Empty state: `text-zinc-500` -> `text-text-muted`
- Empty state link: `text-violet-400` -> `text-accent-muted`, `hover:text-violet-300` -> `hover:text-accent-muted-hover`
- Track cards: `bg-zinc-900/50` -> `bg-surface-raised`, `hover:bg-zinc-800/70` -> `hover:bg-surface-hover`
- Track title: `text-zinc-200` -> `text-text-secondary`
- Category: `text-zinc-500` -> `text-text-muted`
- KEEP status badge colors as-is: `bg-emerald-500/20 text-emerald-400`, `bg-amber-500/20 text-amber-400`, `bg-red-500/20 text-red-400` -- these use default Tailwind palette
- The `bg-zinc-700/50 text-zinc-400` in pending status: replace `bg-zinc-700/50` -> `bg-surface-hover/50`, `text-zinc-400` -> `text-text-tertiary`

**src/routes/admin/upload/+page.svelte:**
- h1: `text-white` -> `text-text-primary`, add `font-heading`
- Subtitle: `text-zinc-500` -> `text-text-muted`
- Drop zone inactive: `border-zinc-700` -> `border-border-default`, `hover:border-zinc-500` -> `hover:border-text-muted`
- Drop zone active: `border-violet-500` -> `border-accent`, `bg-violet-500/10` -> `bg-accent/10`
- Drop zone text: `text-zinc-400` -> `text-text-tertiary`
- Browse button: `bg-zinc-700` -> `bg-surface-hover`, `hover:bg-zinc-600` -> `hover:bg-surface-hover`, `text-zinc-200` -> `text-text-secondary`
- Upload item: `bg-zinc-900/50` -> `bg-surface-raised`
- File name: `text-zinc-200` -> `text-text-secondary`
- Edit metadata link: `text-violet-400` -> `text-accent-muted`, `hover:text-violet-300` -> `hover:text-accent-muted-hover`
- KEEP status badge colors as-is (same pattern as admin/+page.svelte)
- The `bg-zinc-700/50 text-zinc-400` in pending status: replace same as admin page
- The `bg-violet-500/20 text-violet-400` in uploading status: replace `bg-violet-500/20` -> `bg-accent/20`, `text-violet-400` -> `text-accent-muted`

**src/routes/admin/tracks/[id]/+page.svelte:**
- Back link: `text-zinc-500` -> `text-text-muted`, `hover:text-zinc-300` -> `hover:text-text-secondary`
- h1: `text-white` -> `text-text-primary`, add `font-heading`
- KEEP status badge colors as-is
- The `bg-zinc-700/50 text-zinc-400` in pending status: same replacement
- inputClasses const: `bg-zinc-800` -> `bg-surface-overlay`, `border-zinc-700` -> `border-border-default`, `text-zinc-200` -> `text-text-secondary`, `focus:border-violet-500` -> `focus:border-accent`
- Form labels: `text-zinc-400` -> `text-text-tertiary`
- Helper text (slug URL, tag hint): `text-zinc-600` -> `text-text-muted` (WCAG fix)
- File input: `text-zinc-400` -> `text-text-tertiary`, `file:bg-zinc-800` -> `file:bg-surface-overlay`, `file:text-zinc-300` -> `file:text-text-secondary`, `hover:file:bg-zinc-700` -> `hover:file:bg-surface-hover`
- Save button: `bg-violet-600` -> `bg-accent`, `hover:bg-violet-500` -> `hover:bg-accent-hover`
- View public link: `text-violet-400` -> `text-accent-muted`, `hover:text-violet-300` -> `hover:text-accent-muted-hover`
- Form error: `text-red-400` -- keep as-is (status color)

After all files, do a FINAL codebase-wide grep for any remaining zinc-* or violet-* references in src/ (excluding node_modules). The ONLY acceptable matches are status badge colors in admin files: emerald-*, amber-*, red-* are fine. Zero zinc-* and zero violet-* should remain.
  </action>
  <verify>
    1. `npm run build` succeeds
    2. `npm run check` passes
    3. `grep -rn "zinc-" src/` returns zero matches
    4. `grep -rn "violet-" src/` returns zero matches
    5. `grep -rn "#4a4a5a\|#8b5cf6" src/` returns zero matches (no hardcoded hex)
    6. `grep "getComputedStyle" src/lib/components/WaveformPlayer.svelte src/lib/components/PersistentPlayer.svelte` confirms CSS variable pattern in both waveform files
  </verify>
  <done>
    All 7 remaining files migrated to semantic tokens. Waveform hex colors replaced with CSS custom property reads. Zero zinc/violet/hex color references remain in src/. Build and type check pass.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of design system</name>
  <what-built>
    Complete design token migration across all 13 source files:
    - Custom typography: Space Grotesk on headings, Space Mono on timestamps, system fonts for body
    - OKLCH semantic color tokens replacing all hardcoded zinc/violet classes
    - WCAG AA contrast fixes (text-zinc-500 and text-zinc-600 upgraded to text-text-muted)
    - Waveform colors reading from CSS custom properties
  </what-built>
  <how-to-verify>
    1. Start dev server: `cd /home/user/wallybrain-music && npm run dev`
    2. Visit homepage (localhost:5173/music):
       - Headings ("Tracks") should render in Space Grotesk (geometric, slightly condensed) -- visually distinct from default sans-serif
       - Subtitle "electronic music" should be readable (not too faint -- WCAG fix)
       - Category filter pills should have visible text
       - Track card titles should be in Space Grotesk
       - Track durations should be in Space Mono (monospace, even spacing)
    3. Click into a track detail page:
       - Title in Space Grotesk, bold
       - Duration and play count in monospace
       - Category badge and tags visible against background
       - Date at bottom readable (was nearly invisible before -- WCAG fix)
       - Waveform renders with colors (not gray/missing)
    4. Play a track -- check persistent player bar:
       - Timestamp in monospace
       - Waveform renders in player bar
       - All text readable
    5. Visit admin pages (/music/admin):
       - Status badges still show colored (green/amber/red)
       - Form inputs have visible borders and text
       - Labels and helper text readable
    6. WCAG AA contrast check (DSGN-03):
       - In browser DevTools, inspect any text-text-muted element (e.g., subtitle, timestamps)
       - Computed color should be ~oklch(0.60 ...) or equivalent -- NOT zinc-500 (#71717a)
       - Use DevTools Accessibility panel or OddContrast.com to verify >= 4.5:1 contrast against the background
       - Specifically check: track detail date (was 2.57:1), subtitle text (was 4.12:1), CoverArt placeholder icon (was 2.57:1)
    7. Overall: The site should look intentionally styled, not generic. Typography should have clear hierarchy (large bold headings, smaller body, tiny monospace metadata).
  </how-to-verify>
  <resume-signal>Type "approved" if the design system looks correct, or describe any visual issues you see.</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run check` passes
3. Codebase-wide grep confirms zero zinc-*/violet-*/hardcoded hex in src/
4. Both waveform components use getComputedStyle for color reads
5. Visual inspection confirms: Space Grotesk on headings, Space Mono on timestamps, improved contrast on previously-failing text elements
6. WCAG AA verification: grep confirms zero `zinc-500` and `zinc-600` class usage in src/ (the known WCAG violators with 4.12:1 and 2.57:1 ratios). All replacements use text-text-muted (L=0.60, ~5.0:1) which provides comfortable margin above 4.5:1 minimum. Browser DevTools contrast check on previously-failing elements confirms >= 4.5:1 ratio.
</verification>

<success_criteria>
- All 13 source files use semantic design token classes exclusively (zero zinc/violet)
- Waveform components read colors from CSS custom properties with hex fallbacks
- All text passes WCAG AA contrast (4.5:1 minimum) -- particularly the former text-zinc-500 and text-zinc-600 elements
- Typography hierarchy is visually distinct: headings (Space Grotesk), body (system), timestamps (Space Mono)
- Admin status badge colors (emerald/amber/red) preserved using default Tailwind palette
- User visually confirms the design system renders correctly
</success_criteria>

<output>
After completion, create `.planning/phases/08-design-foundation/08-02-SUMMARY.md`
</output>
