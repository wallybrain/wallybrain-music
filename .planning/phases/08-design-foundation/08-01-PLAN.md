---
phase: 08-design-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/app.css
  - src/routes/+layout.svelte
  - src/routes/+page.svelte
  - src/routes/+error.svelte
  - src/lib/components/TrackCard.svelte
  - src/lib/components/FilterBar.svelte
  - src/lib/components/CoverArt.svelte
autonomous: true

must_haves:
  truths:
    - "Headings render in Space Grotesk and body text uses system fonts"
    - "All colors reference semantic OKLCH design tokens defined via @theme"
    - "The homepage, error page, track cards, filter bar, and cover art use semantic token classes with zero hardcoded zinc/violet references"
    - "Text-zinc-500 and text-zinc-600 WCAG AA failures are fixed in migrated files"
  artifacts:
    - path: "src/app.css"
      provides: "Complete @theme design token system with OKLCH colors, font families, and base typography styles"
      contains: "@theme"
    - path: "package.json"
      provides: "Fontsource font dependencies"
      contains: "@fontsource-variable/space-grotesk"
  key_links:
    - from: "src/app.css"
      to: "@fontsource-variable/space-grotesk"
      via: "CSS @import"
      pattern: '@import "@fontsource-variable/space-grotesk"'
    - from: "src/app.css"
      to: "@fontsource/space-mono"
      via: "CSS @import"
      pattern: '@import "@fontsource/space-mono"'
    - from: "src/routes/+layout.svelte"
      to: "src/app.css"
      via: "import ../app.css"
      pattern: 'import.*app.css'
---

<objective>
Install custom fonts, define the OKLCH design token system in app.css, and migrate the 6 public-facing layout/component files from hardcoded zinc/violet classes to semantic tokens.

Purpose: Establishes the design foundation that all subsequent visual work depends on. Replaces the generic Tailwind look with a coherent, accessible token system.
Output: Working design token system with fonts loading, 6 files migrated to semantic tokens.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-design-foundation/08-RESEARCH.md
@src/app.css
@src/routes/+layout.svelte
@src/routes/+page.svelte
@src/routes/+error.svelte
@src/lib/components/TrackCard.svelte
@src/lib/components/FilterBar.svelte
@src/lib/components/CoverArt.svelte
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install fonts and create design token system in app.css</name>
  <files>package.json, src/app.css</files>
  <action>
1. Install font dependencies:
   ```bash
   cd /home/user/wallybrain-music && npm install @fontsource-variable/space-grotesk @fontsource/space-mono
   ```

2. Rewrite `src/app.css` completely with this structure (order matters):

   ```css
   @import "tailwindcss";
   @import "@fontsource-variable/space-grotesk";
   @import "@fontsource/space-mono";
   ```

   Then the `@theme` block with ALL semantic tokens exactly as defined in RESEARCH.md:
   - Font families: --font-heading ("Space Grotesk Variable" + fallbacks), --font-mono ("Space Mono" + fallbacks), --font-body (system stack)
   - Surface colors: --color-surface-base (oklch 0.145), --color-surface-raised (0.21), --color-surface-overlay (0.274), --color-surface-hover (0.335)
   - Text colors: --color-text-primary (0.985), --color-text-secondary (0.871), --color-text-tertiary (0.705), --color-text-muted (0.60 -- this is the WCAG fix, must be L=0.60 not lower)
   - Accent colors: --color-accent (0.585), --color-accent-hover (0.65), --color-accent-muted (0.716), --color-accent-muted-hover (0.78)
   - Border colors: --color-border-default (0.335), --color-border-subtle (0.274)
   - Status colors: --color-status-success, --color-status-warning, --color-status-error (for admin)
   - Waveform colors: --color-waveform-idle (0.40), --color-waveform-progress (0.585), --color-waveform-cursor (0.585)

   Then `@layer base` with:
   - html: background-color var(--color-surface-base), color var(--color-text-secondary), font-family var(--font-body), scroll-behavior smooth
   - h1-h6: font-family var(--font-heading), color var(--color-text-primary)

   Then scrollbar styles using token variables (surface-raised for track, border-default for thumb, text-muted for hover).

   IMPORTANT: Do NOT use `--color-*: initial` -- this would remove all default Tailwind color utilities including emerald, amber, red needed for admin status badges. Only ADD semantic tokens alongside defaults.

3. If Fontsource CSS @import fails (fonts don't load after build), fall back to JS imports in +layout.svelte:
   ```js
   import "@fontsource-variable/space-grotesk";
   import "@fontsource/space-mono";
   ```
   Test by running `npm run build` and checking for import resolution errors.
  </action>
  <verify>
    Run `npm run build` -- must complete with zero errors. Check that the built CSS output contains the @theme token definitions and font-face declarations. Run `npm run check` for TypeScript verification.
  </verify>
  <done>
    app.css contains complete @theme block with all OKLCH tokens and font imports. Fonts installed in node_modules. Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate 6 public-facing files to semantic tokens</name>
  <files>src/routes/+layout.svelte, src/routes/+page.svelte, src/routes/+error.svelte, src/lib/components/TrackCard.svelte, src/lib/components/FilterBar.svelte, src/lib/components/CoverArt.svelte</files>
  <action>
Apply the color mapping from RESEARCH.md to each file. Replace every hardcoded zinc/violet class with its semantic token equivalent. Add font-heading to headings and font-mono to timestamps. After each file, verify zero remaining zinc-* or violet-* references (except status colors in admin files, which are NOT in this task).

**src/routes/+layout.svelte:**
- `text-zinc-300` -> `text-text-secondary`
- `hover:text-white` -> `hover:text-text-primary`
- Add `font-heading` to the "wallybrain" link (it's a site title/heading)

**src/routes/+page.svelte:**
- `text-white` on h1 -> `text-text-primary` (also add `font-heading`)
- `text-zinc-500` on subtitle -> `text-text-muted` (WCAG fix)
- `text-zinc-500` on empty state -> `text-text-muted`
- `text-violet-400` -> `text-accent-muted`
- `hover:text-violet-300` -> `hover:text-accent-muted-hover`

**src/routes/+error.svelte:**
- `text-zinc-300` on h1 -> `text-text-secondary` (also add `font-heading`)
- `text-zinc-500` on error message -> `text-text-muted`
- `text-violet-400` -> `text-accent-muted`
- `hover:text-violet-300` -> `hover:text-accent-muted-hover`

**src/lib/components/TrackCard.svelte:**
- Card container: `bg-zinc-900/50` -> `bg-surface-raised`, `hover:bg-zinc-800/70` -> `hover:bg-surface-hover`
- Title h2: `text-zinc-200` -> `text-text-secondary`, `group-hover:text-white` -> `group-hover:text-text-primary`, add `font-heading`
- Metadata row: `text-zinc-500` -> `text-text-muted` (WCAG fix), add `font-mono tabular-nums` to duration span specifically
- Tag pills: `bg-zinc-800/50` -> `bg-surface-overlay/50`, `text-zinc-500` -> `text-text-muted`
- Play buttons: `bg-violet-600` -> `bg-accent`, `hover:bg-violet-500` -> `hover:bg-accent-hover`
- Paused button: `bg-zinc-700` -> `bg-surface-hover`, `ring-violet-500` -> `ring-accent`, `hover:bg-zinc-600` -> `hover:bg-surface-hover`

**src/lib/components/FilterBar.svelte:**
- Active category pill: `bg-violet-600` -> `bg-accent` (text-white stays as text-text-primary)
- Inactive pill: `bg-zinc-800` -> `bg-surface-overlay`, `text-zinc-400` -> `text-text-tertiary`, `hover:bg-zinc-700` -> `hover:bg-surface-hover`, `hover:text-zinc-300` -> `hover:text-text-secondary`
- Active tag pill: `bg-violet-600` -> `bg-accent`
- Inactive tag: `bg-zinc-800/70` -> `bg-surface-overlay/70`, `text-zinc-500` -> `text-text-muted`, `hover:bg-zinc-700` -> `hover:bg-surface-hover`, `hover:text-zinc-400` -> `hover:text-text-tertiary`
- Clear link: `text-zinc-500` -> `text-text-muted`, `hover:text-zinc-300` -> `hover:text-text-secondary`
- Noscript button: `bg-violet-600` -> `bg-accent`

**src/lib/components/CoverArt.svelte:**
- Placeholder: `bg-zinc-800` -> `bg-surface-overlay`
- Placeholder icon: `text-zinc-600` -> `text-text-muted` (WCAG fix: was 2.57:1 ratio!)

After all replacements, search each file for any remaining `zinc-` or `violet-` strings. There should be ZERO in these 6 files.
  </action>
  <verify>
    Run `npm run build` -- must succeed. Grep all 6 files for `zinc-` and `violet-` -- must return zero matches. Run `npm run check` for type safety.
  </verify>
  <done>
    All 6 public-facing files use only semantic token classes. Zero hardcoded zinc/violet references remain in these files. Build passes. Headings use font-heading class.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `grep -r "zinc-\|violet-" src/routes/+layout.svelte src/routes/+page.svelte src/routes/+error.svelte src/lib/components/TrackCard.svelte src/lib/components/FilterBar.svelte src/lib/components/CoverArt.svelte` returns no matches
3. `grep "@theme" src/app.css` confirms token block exists
4. `grep "Space Grotesk Variable" src/app.css` confirms font-heading definition
5. `grep "font-heading" src/routes/+page.svelte src/lib/components/TrackCard.svelte` confirms typography classes applied
</verification>

<success_criteria>
- Design token system defined in app.css with all OKLCH tokens from RESEARCH.md
- Space Grotesk and Space Mono fonts installed and imported
- Base typography styles set in @layer base (headings use Space Grotesk, body uses system fonts)
- 6 public-facing files fully migrated to semantic token classes
- Zero remaining zinc/violet references in migrated files
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/08-design-foundation/08-01-SUMMARY.md`
</output>
